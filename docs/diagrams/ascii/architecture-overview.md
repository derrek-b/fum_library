# ASCII Architecture Diagrams

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                   FUM Library                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │   Public API    │    │    Adapters     │    │    Helpers      │           │
│  │                 │    │                 │    │                 │           │
│  │ • index.js     │───▶│ • AdapterFactory│───▶│ • tokenHelpers  │           │
│  │ • Re-exports   │    │ • PlatformAdapter│   │ • chainHelpers  │           │
│  │               │    │ • UniswapV3     │   │ • formatHelpers │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│           │                      │                      │                      │
│           ▼                      ▼                      ▼                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │   Blockchain    │    │    Services     │    │    Configs      │           │
│  │                 │    │                 │    │                 │           │
│  │ • wallet.js    │    │ • coingecko.js │    │ • chains.js    │           │
│  │ • contracts.js │    │ • theGraph.js  │    │ • tokens.js    │           │
│  │               │    │                │    │ • strategies.js│           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│           │                      │                      │                      │
│           ▼                      ▼                      ▼                      │
│  ┌─────────────────────────────────────────────────────────────────┐           │
│  │                          Artifacts                              │           │
│  │                     Contract ABIs & Addresses                   │           │
│  └─────────────────────────────────────────────────────────────────┘           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              External Systems                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  Ethereum   │  │  Arbitrum   │  │  CoinGecko  │  │  TheGraph   │         │
│  │  Mainnet    │  │  Network    │  │     API     │  │     API     │         │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module Dependency Tree

```
index.js
├── configs/
│   ├── chains.js
│   ├── platforms.js
│   ├── strategies.js
│   └── tokens.js
│
└── adapters/
    ├── AdapterFactory.js
    │   ├── chains.js ←
    │   └── UniswapV3Adapter.js
    │       ├── PlatformAdapter.js
    │       ├── formatHelpers.js
    │       └── [external: ethers, @uniswap/v3-sdk]
    │
    └── PlatformAdapter.js (abstract)

helpers/
├── chainHelpers.js
│   └── chains.js ←
│
├── formatHelpers.js
│
├── platformHelpers.js
│   ├── platforms.js ←
│   └── chainHelpers.js
│
├── strategyHelpers.js
│   └── strategies.js ←
│
├── tokenHelpers.js
│   └── tokens.js ←
│
└── formatHelpers.js

blockchain/
├── wallet.js
│   └── [external: ethers]
│
└── contracts.js
    ├── artifacts/contracts.js
    └── [external: ethers]

services/
├── coingecko.js
│   └── tokenHelpers.js
│
└── theGraph.js

← = imported from configs/
```

## Data Flow Diagram

```
User Request
     │
     ▼
┌─────────────┐
│  getVault   │
│    Data     │
└─────────────┘
     │
     ├──────────────────────┬────────────────────┐
     ▼                      ▼                    ▼
┌─────────────┐      ┌─────────────┐     ┌─────────────┐
│   Get       │      │   Get       │     │   Get       │
│   Vaults    │      │  Strategy   │     │   Token     │
└─────────────┘      └─────────────┘     │   Data      │
     │                      │             └─────────────┘
     ▼                      ▼                    │
┌─────────────┐      ┌─────────────┐            │
│   Get       │      │  Get Params │            │
│ Positions   │      └─────────────┘            │
└─────────────┘             │                    │
     │                      │                    │
     ├──────────────────────┴────────────────────┤
     ▼                                           ▼
┌─────────────┐                          ┌─────────────┐
│  Calculate  │                          │   Fetch     │
│   Amounts   │                          │   Prices    │
└─────────────┘                          └─────────────┘
     │                                           │
     │                                    ┌──────┴──────┐
     │                                    ▼             ▼
     │                              ┌─────────┐   ┌─────────┐
     │                              │  Cache  │   │   API   │
     │                              │   Hit   │   │  Call   │
     │                              └─────────┘   └─────────┘
     │                                    │             │
     └────────────────────────────────────┴─────────────┘
                                          │
                                          ▼
                                   ┌─────────────┐
                                   │  Calculate  │
                                   │     TVL     │
                                   └─────────────┘
                                          │
                                          ▼
                                   ┌─────────────┐
                                   │   Return    │
                                   │   Results   │
                                   └─────────────┘
```

## Component Interaction Map

```
┌──────────────────────────────────────────────────────────────────┐
│                         User Application                         │
└──────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌──────────────────────────────────────────────────────────────────┐
│                          FUM Library API                         │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐│
│  │            │  │            │  │            │  │            ││
│  │  Adapters  │◀─│  Helpers   │◀─│ Blockchain │  │  Services  ││
│  │            │  │            │  │            │  │            ││
│  └────────────┘  └────────────┘  └────────────┘  └────────────┘│
│        ▲               ▲               ▲               ▲        │
│        │               │               │               │        │
│        └───────────────┴───────────────┴───────────────┘        │
│                                │                                │
│                                ▼                                │
│                        ┌────────────┐                           │
│                        │  Configs   │                           │
│                        └────────────┘                           │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌────────────────┐     ┌────────────────┐     ┌────────────────┐
│   UniswapV3    │     │   Ethereum     │     │   CoinGecko    │
│   Protocol     │     │   Network      │     │      API       │
└────────────────┘     └────────────────┘     └────────────────┘
```

## Price Cache Flow

```
                    ┌─────────────────┐
                    │ Price Request   │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  Check Cache    │
                    └────────┬────────┘
                             │
                ┌────────────┴────────────┐
                │                         │
                ▼                         ▼
       ┌─────────────────┐       ┌─────────────────┐
       │   Cache Hit     │       │   Cache Miss    │
       │   (< 60s old)   │       │                 │
       └────────┬────────┘       └────────┬────────┘
                │                         │
                │                         ▼
                │                ┌─────────────────┐
                │                │  Add to Batch   │
                │                └────────┬────────┘
                │                         │
                │                         ▼
                │                ┌─────────────────┐
                │                │ Wait 100ms or   │
                │                │ Batch Full      │
                │                └────────┬────────┘
                │                         │
                │                         ▼
                │                ┌─────────────────┐
                │                │ API Request     │
                │                └────────┬────────┘
                │                         │
                │                         ▼
                │                ┌─────────────────┐
                │                │ Update Cache    │
                │                └────────┬────────┘
                │                         │
                └─────────────┬───────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  Return Price   │
                    └─────────────────┘
```